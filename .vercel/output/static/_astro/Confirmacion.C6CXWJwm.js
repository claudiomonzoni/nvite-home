import{j as e}from"./jsx-runtime.B4Eza4VF.js";import{r as n}from"./index.B3-cpKCK.js";import{e as o}from"./confirmacion.module.CXaCJAZP.js";import"./_commonjsHelpers.D6-XlEtG.js";const J=async()=>{if(!(typeof window>"u")){typeof window.confetti!="function"&&await new Promise((m,u)=>{const c=document.createElement("script");c.src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js",c.onload=m,c.onerror=u,document.body.appendChild(c)});try{let c=function(){window.confetti({...u,particleCount:150})};const u={spread:120,ticks:100,gravity:.5,decay:.95,startVelocity:20,shapes:["square","circle","triangle"],colors:["#ff61d2","#ff90e8","#ffc4f3","#ffd9f9","#00d4ff","#00fff7","#73ffff","#fffd37","#fff620","#ffef00","#ff3477","#ff0051","#ff005d"],scalar:.9,origin:{x:.5,y:.55}};c(),setTimeout(c,150),setTimeout(c,300)}catch(m){console.error("Error en confetti:",m)}}};function X({whatsapp:m,dias_antes:u,version:c}){const[b,k]=n.useState("sin datos"),[p,q]=n.useState(0),[$,U]=n.useState(0),[t,L]=n.useState(!1),[f,E]=n.useState("0"),[r,F]=n.useState(""),[S,v]=n.useState(null),[T,C]=n.useState(!1),[d,g]=n.useState(""),[N,y]=n.useState(!1),[H,I]=n.useState(!1),[V,z]=n.useState(""),i=n.useRef(null),M=n.useMemo(()=>{const a=navigator.userAgent;return/Mobile/i.test(a)?"https://api.whatsapp.com/send/?phone=":"https://web.whatsapp.com/send/?phone="},[]);n.useEffect(()=>{(async()=>{C(!0),v(null);try{const s=new URLSearchParams(window.location.search),l=s.get("id"),w=s.get("uid");if(!l||!w)throw new Error("Par√°metros de invitaci√≥n inv√°lidos");const x=await fetch(`${window.location.origin}/api/getInvitado.json?id=${encodeURIComponent(l)}&uid=${encodeURIComponent(w)}`);if(!x.ok)throw new Error(`Error del servidor: ${x.status}`);const j=await x.json();if(!j||!j[0])throw new Error("No se encontr√≥ la informaci√≥n del invitado");k(j[0].nombre),q(Math.trunc(j[0].pases)),U(j[0].id),L(j[0].confirmado)}catch(s){v("La direcci√≥n de esta invitaci√≥n es incorrecta y no podemos mostrar el formulario de confirmaci√≥n, Por favor, int√©ntalo de nuevo con la direcci√≥n correcta de su invitaci√≥n."),console.error("Error fetching invitado:",s)}finally{C(!1)}})()},[]);const h=n.useCallback((a,s)=>{if(!i.current)return;const l=a!=="0"?a:"0",w=N&&d.trim()?`%0aPersonas que no podr√°n asistir: ${encodeURIComponent(d)}`:"",x=t?`Hola,%20les%20confirmo%20la%20asistencia%20a%20la%20boda:%20${encodeURIComponent(b)},%20y%20usaremos%20${encodeURIComponent(l)}%20pase(s).${w}%0aComentarios:%20${encodeURIComponent(s||"Sin comentarios")}.`:`Hola,%20lamento%20informarles%20que%20no%20podr√©%20asistir%20a%20la%20boda:%20${encodeURIComponent(b)}.%0aComentarios:%20${encodeURIComponent(s||"Sin comentarios")}.`;i.current.href=`${M}${encodeURIComponent(m)}&text=${x}`},[M,m,b,t,N,d]),D=n.useCallback(a=>{const s=parseInt(a.target.value,10);if(E(Math.trunc(s)),s!=="0"){const l=parseInt(s);y(l<p),l>=p&&g("")}else y(!1),g("");i.current&&(s&&s!=="0"?i.current.classList.remove(`${o.desactivado}`):i.current.classList.add(`${o.desactivado}`)),h(s,r)},[h,r,p]),Z=n.useCallback(a=>{const s=a.target.value;g(s),h(f,r)},[h,f,r]),A=n.useCallback(a=>{const s=a.target.value;F(s),h(f,s)},[h,f]),B=n.useCallback(a=>{if(L(a),E(0),y(!1),g(""),a&&typeof window<"u")try{J()}catch(s){console.error("Error ejecutando confetti:",s)}!a&&i.current&&i.current.classList.remove(`${o.desactivado}`)},[]),P=n.useCallback(async a=>{C(!0),v(null);try{const s=await fetch(`/api/${encodeURIComponent($)}.json`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({confirmado:a,noAsiste:!a,pases:a?Math.trunc(f):0,comentarios:r.trim(),personasNoAsisten:d.trim()})});if(!s.ok){const l=await s.text();throw new Error(`Error en la solicitud: ${s.status} ${s.statusText}. ${l}`)}}catch(s){v(s.message),console.error("Error actualizando asistencia:",s)}finally{C(!1)}},[$,r,f,d]),R=n.useCallback(async a=>{if(a.preventDefault(),!a.target.classList.contains(`${o.desactivado}`))try{const s=i.current?.href;await P(t),r.trim()!==""||d.trim()!==""?s&&window.open(s,"_blank"):(z(t?"¬°Muchas gracias por confirmar su asistencia! Nos llena de alegr√≠a saber que podremos contar con su presencia en este d√≠a tan especial.":"Agradecemos mucho su pronta respuesta. Lamentamos que no pueda acompa√±arnos en esta ocasi√≥n tan especial."),I(!0))}catch(s){console.error("Error al procesar la confirmaci√≥n:",s)}},[P,t,r,d]),O=n.useMemo(()=>{const a=[e.jsx("option",{value:"0",children:"Selecciona el n√∫mero de pases"},"0")];for(let s=1;s<=p;s++)a.push(e.jsx("option",{value:s,children:s},s));return a},[p]);return T?e.jsx("div",{className:"loading",children:"Cargando..."}):S?e.jsxs("div",{className:"error",children:["Error: ",S]}):p===0&&!t?e.jsx("div",{className:"grid contenido",children:e.jsx("div",{className:o.confirmacion,children:e.jsx("div",{className:o.bandeja,children:e.jsx("p",{className:o.mensajeNoAsistencia,children:"Estimado invitado, agradecemos que nos haya notificado su imposibilidad de asistir. Si sus planes cambian, por favor no dude en contactar directamente con los anfitriones."})})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid contenido",id:"Confirmacion-comun",children:e.jsx("div",{className:`${o.confirmacion} ${t?o.asistira:o.noAsistira}`,children:e.jsxs("div",{className:o.bandeja,children:[e.jsx("svg",{viewBox:"0 0 41 31",fill:"none",children:e.jsx("path",{d:"M41 6.3152H22.55V10.4293H41V6.3152ZM41 22.7717H22.55V26.8859H41V22.7717ZM7.257 14.5435L0 7.26145L2.8905 4.36098L7.2365 8.72196L15.9285 0L18.819 2.90046L7.257 14.5435ZM7.257 31L0 23.718L2.8905 20.8175L7.2365 25.1785L15.9285 16.4565L18.819 19.357L7.257 31Z",fill:"white"})}),e.jsx("h2",{children:"¬øContamos con tu presencia?"}),e.jsxs("p",{children:["Por favor ",e.jsx("b",{children:"conf√≠rmanos"})," tu asistencia"," ",e.jsxs("b",{children:["al menos ",u," d√≠as antes del evento"]}),", nos ayudar√°s mucho con la organizaci√≥n al hacerlo."]}),e.jsxs("form",{id:o.formulario,onSubmit:a=>a.preventDefault(),children:[e.jsxs("div",{className:o.conteCheck,children:[e.jsx("p",{children:t?"¬°Confirmo asistencia! üòÑ":"Lo lamento, no podr√© asistir üòî"}),e.jsxs("label",{className:o.switch,children:[e.jsx("input",{type:"checkbox",checked:t,onChange:a=>B(a.target.checked)}),e.jsx("span",{className:o.slider})]})]}),e.jsxs("p",{id:o.mueve,children:["Mueve el ",e.jsx("span",{children:"switch a la derecha "}),"para confirmar tu asistencia y despues completa el formulario de confirmaci√≥n."]}),t?e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"pases",children:"¬øCu√°ntos pases usar√°n?"}),e.jsx("select",{name:"pases",id:"Confipases",required:!0,value:f,onChange:D,children:O}),N&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"personasNoAsisten",children:"¬øNombre de las personas que no podr√°n acompa√±arnos? (opcional)"}),e.jsx("textarea",{name:"personasNoAsisten",id:"personasNoAsisten",value:d,onChange:Z,placeholder:"Escribe aqu√≠ los nombres...",maxLength:500}),e.jsxs("small",{children:["Si cambian de opini√≥n y pueden acompa√±arnos al evento, no duden en"," ",e.jsxs("u",{children:["contactarnos directamente ",u," d√≠as antes"]})," ","del evento."]})]}),e.jsx("label",{htmlFor:"comentarios",children:"Env√≠anos alg√∫n saludo (opcional):"}),e.jsx("textarea",{name:"comentarios",id:"comentarios",value:r,onChange:A,placeholder:"Escribe aqu√≠ tu mensaje...",maxLength:500}),e.jsxs("a",{href:"#",className:`${o.btnConfirmar} ${o.desactivado}`,ref:i,onClick:R,children:[e.jsx("img",{src:"/whatsapp.png",alt:"confirmar whatsapp"})," ","Confirmar mi asistencia"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"comentarios",children:"¬øDeseas dejar un mensaje? (opcional):"}),e.jsx("textarea",{name:"comentarios",id:"comentarios",value:r,onChange:A,placeholder:"Escribe aqu√≠ tu mensaje...",maxLength:500}),e.jsxs("small",{children:[e.jsx("span",{children:"IMPORTANTE:"})," En caso de que si puedan acompa√±arnos, les pedimos amablemente que nos"," ",e.jsxs("span",{children:["confirmen directamente al menos ",u," d√≠as antes"]})," ","del evento."]}),e.jsxs("a",{href:"#",className:o.btnConfirmar,ref:i,onClick:R,children:[e.jsx("img",{src:"/whatsapp.png",alt:"confirmar whatsapp"})," ","No podr√© asistir"]})]})]})]})})}),H&&e.jsx("div",{className:o.modal,children:e.jsxs("div",{className:o.modalContent,children:[e.jsx("p",{children:V}),e.jsx("button",{onClick:()=>I(!1),children:"Cerrar"})]})})]})}export{X as default};
